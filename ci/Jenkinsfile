pipeline{
    agent any
    environment{
        def secret = 'some useful text as def'
        def some = "so what is it"
    }
    options{
        //keep only the last 10 builds
        buildDiscarder(logRotator(numToKeepStr:'10'))
        // disable same jobs running in parallel
        disableConcurrentBuilds()      
        // timeout for whole pipeline in case of some step hanging
        // 300s:5 minute
        timeout(time: 300, unit: 'SECONDS')
    }
    stages{
        stage('NPM INSTALL'){
           
            agent {
                docker {
                    image 'node:24-bullseye'
                    reuseNode true
                }
            }
            steps {
               echo 'Running npm ci...' 
               echo "${env.BRANCH_NAME}"
               sh '''
                    node --version
                    npm --version
                    npm ci
                '''
            }
        }
        stage('BUILD PROJECT'){
            agent {
                docker {
                    image 'node:24'
                    reuseNode true
                }
            }
            steps{
                echo 'Build process started'
                sh '''
                    npm run build
                '''
            }
            
            post{
                success {
                    echo 'Build process completed!'
                }
                failure {
                    echo 'build failed...' 
                }
            }
        }
        stage("DEPLOYMENT"){
            agent{
                docker {
                    image 'node:24'
                    reuseNode true
                }
            }
            steps{
                sh '''
                    npm install netlify-cli
                '''
            }
        }
    }
}